---
title: PV & PVC
date: 2020-10-20 09:23:52
categories: ["Kubernetes"]
tags: ["K8S", "PV", "PVC", "쿠버네티스"] 
---
## PV

클러스터 리소스 이다.

pv 와 pvc 는 1:1 바인딩이며 pvc 가 요청하는 볼륨이 pv 에 없으면 무한 대기 한다.

pod 이 사용중인 pvc 는 삭제가 불가능 하다.

### PV volumeModes

- Filesystem : Pod 의 디렉토리에 마운트 됨
- Block


### PersistentVolumeReclaimPolicy 
PVC 삭제시 PV 데이터에 대한 정책

- Retail : 그대로 보존
- Recycle : 재사용시 기존 pv 데이터들 삭제 후 재사용 (이건 사용 안함)
- Delete : 볼륨 삭제 

### RecaimPolicy Update

kubectl patch pv <your-pv-name> -p '{"spec":{"persistentVolumeReclaimPolicy":"Retain"}}'

### PV & PVC YAML 샘플

```
apiVersion: v1
kind: PersistentVolume
metadata:
  namespace: spring
  name: mysql-pv
spec:
  storageClassName: local-path
  accessModes:
    - ReadWriteOnce
  capacity:
    storage: 2Gi
  hostPath:
    path: /home/master01/k8s/mysql-data
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  namespace: spring
  name: mysql-pvc2
spec:
  storageClassName: local-path1
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
```

참고 사이트
https://kubernetes.io/ko/docs/concepts/storage/persistent-volumes/
https://kubernetes.io/ko/docs/tasks/administer-cluster/change-pv-reclaim-policy/